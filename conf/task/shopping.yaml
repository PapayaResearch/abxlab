# ================================================================================
# Configurable Nudge Task Generator
#
# This is a base task configuration for the shopping site (do not use directly).
# ================================================================================

# Browser configuration
width: 1280
height: 720
slow_mo: 1000 # ms
timeout: 10000 # ms

entrypoint: nudgelab.task.NudgeLabShopTask

config:
  # Site configuration
  sites:
    - shopping
  task_id: ???  # Override with e.g. task.config.task_id=1
  require_login: false
  storage_state: ${hydra:runtime.cwd}/.auth/shopping_state.json

  # URLs to study (MUST be specified)
  start_urls: []  # Override with task.config.start_urls=[url1,url2] for tab choice tasks, or task.config.start_urls=url for single URL tasks

  # Task specification
  intent_template: ???  # Override with e.g. task.config.intent_template="..."
  intent: ${task.config.intent_template}  # Override with e.g. task.config.intent="..." if the intent template has placeholders
  intent_template_id: ??? # Override with e.g. task.config.intent_template_id=0
  require_reset: ${task.config.require_login} # By default, require reset if login is required

  # Directory to write metadata (here we reverse-engineer the browsergym format, since we can't directly use it for now)
  metadata_dir: ${experiment.root_dir}/${now:%Y-%m-%d_%H-%M-%S}_GenericAgent-${agent.chat_model_args.model_name}_on_${benchmark.name}.${task.name}_0

  # Evaluation setup
  eval:
    eval_types:
      - program_html
    # Each tab choice task MUST include some choices
    # These can be configured via command line arguments
    choices:
        - url: ??? # Example URL
          nudge: ??? # Type of nudge
          functions:
            - module: nudgelab.choices.shop
              name: ???
              args:
                value: ???
    program_html:
      - url: last
        locator: "document.querySelector('div.message-success div[data-bind*=\"prepareMessageForHtml\"]').innerText"
        required_contents:
          must_include:
            - "You added"
